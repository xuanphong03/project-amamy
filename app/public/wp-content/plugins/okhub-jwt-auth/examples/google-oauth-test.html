<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Google OAuth Test</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                max-width: 800px;
                margin: 0 auto;
                padding: 20px;
                background-color: #f5f5f5;
            }
            .container {
                background: white;
                padding: 30px;
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
            h1 {
                color: #333;
                text-align: center;
                margin-bottom: 30px;
            }
            .form-group {
                margin-bottom: 20px;
            }
            label {
                display: block;
                margin-bottom: 5px;
                font-weight: bold;
                color: #555;
            }
            input[type="text"],
            input[type="email"],
            textarea {
                width: 100%;
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 5px;
                font-size: 16px;
            }
            button {
                background: #007cba;
                color: white;
                padding: 12px 24px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 16px;
                margin-right: 10px;
                margin-bottom: 10px;
            }
            button:hover {
                background: #005a87;
            }
            .response {
                margin-top: 20px;
                padding: 15px;
                border-radius: 5px;
                white-space: pre-wrap;
                font-family: monospace;
                font-size: 14px;
            }
            .success {
                background: #d4edda;
                border: 1px solid #c3e6cb;
                color: #155724;
            }
            .error {
                background: #f8d7da;
                border: 1px solid #f5c6cb;
                color: #721c24;
            }
            .auth-method {
                background: #e7f3ff;
                border: 1px solid #b3d9ff;
                padding: 15px;
                margin: 20px 0;
                border-radius: 5px;
            }
            .auth-method h3 {
                margin-top: 0;
                color: #0066cc;
            }
            .radio-group {
                margin-bottom: 15px;
            }
            .radio-group label {
                display: inline-block;
                margin-right: 20px;
                font-weight: normal;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>üîê Google OAuth Test</h1>

            <div class="auth-method">
                <h3>üìã Authentication Methods</h3>
                <div class="radio-group">
                    <label>
                        <input
                            type="radio"
                            name="auth_method"
                            value="idToken"
                            checked
                            onchange="toggleAuthMethod()"
                        />
                        ID Token (Recommended)
                    </label>
                    <label>
                        <input
                            type="radio"
                            name="auth_method"
                            value="accessToken"
                            onchange="toggleAuthMethod()"
                        />
                        Access Token
                    </label>
                    <label>
                        <input
                            type="radio"
                            name="auth_method"
                            value="fallback"
                            onchange="toggleAuthMethod()"
                        />
                        Fallback (Less Secure)
                    </label>
                </div>
            </div>

            <div id="idToken_method" class="auth-method">
                <h3>üîë ID Token Authentication</h3>
                <div class="form-group">
                    <label for="id_token">ID Token:</label>
                    <textarea
                        id="id_token"
                        rows="3"
                        placeholder="eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
                    ></textarea>
                </div>
            </div>

            <div
                id="accessToken_method"
                class="auth-method"
                style="display: none"
            >
                <h3>üé´ Access Token Authentication</h3>
                <div class="form-group">
                    <label for="access_token">Access Token:</label>
                    <input
                        type="text"
                        id="access_token"
                        placeholder="ya29.a0AfH6SMC..."
                    />
                </div>
            </div>

            <div id="fallback_method" class="auth-method" style="display: none">
                <h3>‚ö†Ô∏è Fallback Authentication (Less Secure)</h3>
                <div class="form-group">
                    <label for="fallback_email">Email:</label>
                    <input
                        type="email"
                        id="fallback_email"
                        value="testuser@gmail.com"
                    />
                </div>
                <div class="form-group">
                    <label for="fallback_google_id">Google ID:</label>
                    <input
                        type="text"
                        id="fallback_google_id"
                        value="12345678901234567890"
                    />
                </div>
                <div class="form-group">
                    <label for="fallback_name">Name:</label>
                    <input type="text" id="fallback_name" value="Test User" />
                </div>
            </div>

            <button onclick="testGoogleOAuth()">Test Google OAuth</button>
            <button onclick="fillSampleData()">Fill Sample Data</button>

            <div id="result" class="response" style="display: none"></div>
        </div>

        <script>
            const siteUrl = window.location.origin;
            const apiUrl = `${siteUrl}/wp-json/okhub-jwt/v1`;

            function toggleAuthMethod() {
                const method = document.querySelector(
                    'input[name="auth_method"]:checked'
                ).value;

                // Hide all methods
                document.getElementById("idToken_method").style.display =
                    "none";
                document.getElementById("accessToken_method").style.display =
                    "none";
                document.getElementById("fallback_method").style.display =
                    "none";

                // Show selected method
                document.getElementById(method + "_method").style.display =
                    "block";
            }

            async function testGoogleOAuth() {
                const method = document.querySelector(
                    'input[name="auth_method"]:checked'
                ).value;
                const result = document.getElementById("result");

                result.style.display = "none";

                let requestData = {
                    provider: "google",
                };

                switch (method) {
                    case "idToken":
                        const idToken = document
                            .getElementById("id_token")
                            .value.trim();
                        if (!idToken) {
                            showResult("Please enter ID Token", false);
                            return;
                        }
                        requestData.idToken = idToken;
                        break;

                    case "accessToken":
                        const accessToken = document
                            .getElementById("access_token")
                            .value.trim();
                        if (!accessToken) {
                            showResult("Please enter Access Token", false);
                            return;
                        }
                        requestData.accessToken = accessToken;
                        break;

                    case "fallback":
                        const email = document
                            .getElementById("fallback_email")
                            .value.trim();
                        const googleId = document
                            .getElementById("fallback_google_id")
                            .value.trim();
                        const name = document
                            .getElementById("fallback_name")
                            .value.trim();

                        if (!email || !googleId || !name) {
                            showResult(
                                "Please fill all fallback fields",
                                false
                            );
                            return;
                        }

                        requestData.email = email;
                        requestData.googleId = googleId;
                        requestData.name = name;
                        break;
                }

                try {
                    const response = await fetch(
                        `${apiUrl}/auth/social/login`,
                        {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify(requestData),
                        }
                    );

                    const data = await response.json();
                    showResult(JSON.stringify(data, null, 2), response.ok);
                } catch (error) {
                    showResult("Network error: " + error.message, false);
                }
            }

            function showResult(message, isSuccess) {
                const result = document.getElementById("result");
                result.style.display = "block";
                result.className = `response ${
                    isSuccess ? "success" : "error"
                }`;
                result.textContent = message;
            }

            function fillSampleData() {
                const method = document.querySelector(
                    'input[name="auth_method"]:checked'
                ).value;

                switch (method) {
                    case "idToken":
                        document.getElementById("id_token").value =
                            "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c";
                        break;

                    case "accessToken":
                        document.getElementById("access_token").value =
                            "ya29.a0AfH6SMC1234567890abcdefghijklmnopqrstuvwxyz";
                        break;

                    case "fallback":
                        document.getElementById("fallback_email").value =
                            "testuser" +
                            Math.floor(Math.random() * 1000) +
                            "@gmail.com";
                        document.getElementById("fallback_google_id").value =
                            Math.random().toString(36).substr(2, 20);
                        document.getElementById("fallback_name").value =
                            "Test User " + Math.floor(Math.random() * 1000);
                        break;
                }
            }
        </script>
    </body>
</html>
